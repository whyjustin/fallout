<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjExYjc0YTUyNzgwMDk5ZjEzNDY0MmNlZWM3ZGE4MjNkMTc4MDc2ZjIiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwOTc3OTMyNzgzODcwOTcyMzg0NSIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiI1OGExNTk4NWZkYjktdGhlX2NoYWlyX2NvbXBhbnkuaHRtbC0yODUifSwiZXhwIjoxNzY0OTcwODk5LCJpYXQiOjE3NjQ5NjcyOTksImFsZyI6IlJTMjU2In0.WenHC6XPWemu0qyMcQvx_rwTFA7L6Ahkpo8RoK-nSu14Xx0GAi4PxhX9VThlDts4SakOza_kQ3RpRoCPG0d47iEg9HqwIaDbavTVhn3f2XffvBRIbSUxaSrPTbhT7VpfmO_Kl-nyVOR-aaJEswiSN0ZEsevCgsmcRiwjsDHvQn83iDPwdd1IMpQU9MIhEatmntUyNgroU4iRB9GGGOumhckKz6vRDqW-Lu2oI6TgFJlnBSFqbCzaDvhtlXmz6bTMg0VVG1KxJNdtmc6lrO_52vgj1-vfO1RRmudwwKPZ_I0DTfLc8rp2C34C7M-K3T5iFXcfXaKwYcsFo6xBYLylTw","58a15985fdb9-the_chair_company.html-285")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CHAIR COMPANY: A Ron Trosper Simulation</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --term-color: #33ff00;
            --term-dim: #1a8000;
            --alert-color: #ff3300;
            --ui-border: 2px solid #33ff00;
            --font-main: 'Courier New', Courier, monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--term-color);
            font-family: var(--font-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
        }

        #game-container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            grid-template-rows: 60px 1fr 150px;
            gap: 10px;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header */
        header {
            grid-column: 1 / -1;
            border-bottom: var(--ui-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }

        h1 {
            font-size: 1.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #stats-bar {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }

        .stat {
            color: var(--term-dim);
        }
        .stat span {
            color: var(--term-color);
            font-weight: bold;
        }

        /* Main Output Log */
        #log-container {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            border: var(--ui-border);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background: rgba(0, 20, 0, 0.5);
        }

        .log-entry {
            margin-bottom: 15px;
            line-height: 1.4;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        .log-entry.system { color: #ffff00; }
        .log-entry.dialogue { color: #ffffff; }
        .log-entry.horror { color: var(--alert-color); font-weight: bold; }
        .log-entry.choice-prompt { border-top: 1px dashed var(--term-dim); padding-top: 10px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Sidebar / Inventory */
        #sidebar {
            grid-column: 2 / 3;
            grid-row: 2 / 4;
            border: var(--ui-border);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            border: 1px solid var(--term-dim);
            padding: 10px;
        }

        .panel h3 { margin-top: 0; font-size: 1rem; border-bottom: 1px solid var(--term-dim); }

        #inventory-list, #clue-list {
            list-style: none;
            padding: 0;
            font-size: 0.85rem;
        }

        #inventory-list li, #clue-list li {
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        #inventory-list li:hover { text-decoration: underline; }

        /* Controls */
        #controls {
            grid-column: 1 / 2;
            grid-row: 3 / 4;
            border: var(--ui-border);
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #choice-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        button {
            background: transparent;
            border: 1px solid var(--term-color);
            color: var(--term-color);
            padding: 10px 15px;
            font-family: var(--font-main);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        button:hover {
            background: var(--term-color);
            color: #000;
        }

        button:disabled {
            border-color: var(--term-dim);
            color: var(--term-dim);
            cursor: not-allowed;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            #game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto auto;
            }
            #sidebar { grid-column: 1 / -1; grid-row: 3 / 4; max-height: 150px; overflow-y: auto; }
            #controls { grid-row: 4 / 5; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--term-dim); }
        ::-webkit-scrollbar-thumb:hover { background: var(--term-color); }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>THE CHAIR COMPANY</h1>
        <div id="stats-bar">
            <div class="stat">DAY: <span id="day-display">1</span></div>
            <div class="stat">TIME: <span id="time-display">09:00</span></div>
            <div class="stat">DIGNITY: <span id="dignity-display">3.9%</span></div>
            <div class="stat">PARANOIA: <span id="paranoia-display">HI</span></div>
        </div>
    </header>

    <div id="log-container">
        <!-- Text goes here -->
    <div class="log-entry system">Initializing Ron Trosper OS v1.0...</div><div class="log-entry dialogue">You are Ron Trosper.</div><div class="log-entry dialogue">Yesterday, you were a Project Manager. Yesterday, you were giving the presentation of your life at the Canton Marketplace groundbreaking.</div><div class="log-entry dialogue">Then you sat down.</div><div class="log-entry dialogue">The chair—a Tecca Model 400 ergonomic mesh—didn't just break. It EXPLODED. It sounded like a gunshot. You fell. Your pants ripped. The client, Mr. Levjman, laughed. Everyone laughed.</div><div class="log-entry dialogue">Now you are suspended. Barb is in the kitchen aggressively blending a smoothie. You have 5 days before the HR hearing to prove it wasn't you. It was the chair. It was a conspiracy.</div><div class="log-entry dialogue">Goal: Find proof of the Tecca Chair Defect.</div></div>

    <div id="sidebar">
        <div class="panel">
            <h3>POCKETS</h3>
            <ul id="inventory-list"><li>- Wallet</li><li>- Keys</li><li>- Broken Caster Wheel</li></ul>
        </div>
        <div class="panel">
            <h3>CONSPIRACY BOARD</h3>
            <ul id="clue-list"></ul>
        </div>
        <div class="panel" style="margin-top:auto">
            <h3>STATUS</h3>
            <div id="status-text" style="font-size: 0.8rem; color: #aaa;">Suspended pending investigation.</div>
        </div>
    </div>

    <div id="controls">
        <div id="choice-buttons"><button>&gt; Go to Kitchen</button><button>&gt; Check Email</button><button>&gt; Inspect the Broken Wheel</button></div>
    </div>
</div>

<script>
/**
 * THE CHAIR COMPANY - TEXT ADVENTURE ENGINE
 * A simulation of corporate paranoia.
 */

// --- GAME STATE ---
const initialState = {
    day: 1,
    time: 900, // 09:00 (24h format integer)
    maxTime: 1700, // 5:00 PM
    location: 'home',
    inventory: ['Wallet', 'Keys', 'Broken Caster Wheel'],
    clues: [],
    flags: {
        met_alice: false,
        found_warehouse: false,
        knows_passcode: false,
        chair_analyzed: false,
        ham_trick_done: false,
        tecca_called: false,
        wife_angry: true
    },
    history: [] // For saving previous run knowledge if we implement rogue-lite elements
};

let state = JSON.parse(JSON.stringify(initialState));

// --- CONSTANTS ---
const LOCATIONS = {
    'home': 'Your House',
    'mall_site': 'Canton Marketplace Site',
    'tecca_factory': 'Tecca Chairs Factory',
    'electronics': 'Circuit City (Defunct)',
    'warehouse': 'Unknown Warehouse'
};

// --- CONTENT DATABASE ---
// This is a simplified graph. In a full 2-hour game, this would be massive.
// We simulate depth by requiring knowledge from "future" events to solve "past" puzzles in a loop.

const SCENES = {
    'intro': {
        text: [
            "You are Ron Trosper.",
            "Yesterday, you were a Project Manager. Yesterday, you were giving the presentation of your life at the Canton Marketplace groundbreaking.",
            "Then you sat down.",
            "The chair—a Tecca Model 400 ergonomic mesh—didn't just break. It EXPLODED. It sounded like a gunshot. You fell. Your pants ripped. The client, Mr. Levjman, laughed. Everyone laughed.",
            "Now you are suspended. Barb is in the kitchen aggressively blending a smoothie. You have 5 days before the HR hearing to prove it wasn't you. It was the chair. It was a conspiracy.",
            "Goal: Find proof of the Tecca Chair Defect."
        ],
        choices: [
            { text: "Go to Kitchen", target: 'kitchen' },
            { text: "Check Email", target: 'computer_home' },
            { text: "Inspect the Broken Wheel", target: 'inspect_wheel' }
        ]
    },
    'kitchen': {
        text: [
            "Barb is there. She's looking at you like you're a stranger who owes her money.",
            "BARB: 'Ron. HR called. They said you shouted 'This is a hit!' when you fell. Did you say that?'",
            "The blender roars, drowning out your answer."
        ],
        choices: [
            { text: "Lie and say you didn't", target: 'kitchen_lie', cost: 30 },
            { text: "Ask about her startup 'Everpump'", target: 'kitchen_everpump', cost: 30 },
            { text: "Leave before it gets worse", target: 'hub' }
        ]
    },
    'kitchen_lie': {
        text: ["You try to deny it. Barb just points to the iPad. The video has 4 million views. The caption is 'Chair Man Goes Boom'. Your dignity drops."],
        effect: (s) => { adjustDignity(-10); },
        choices: [{ text: "Back", target: 'hub' }]
    },
    'kitchen_everpump': {
        text: ["Barb's eyes narrow. 'Don't pivot to Everpump, Ron. We need that angel investment. If you embarrass us, Alice Quintana pulls the funding.'", "Wait. Alice Quintana? The Purchasing Director for the city? Why is she funding your wife's pump company?"],
        effect: (s) => { addClue("Alice Quintana funds Barb"); },
        choices: [{ text: "Interesting...", target: 'hub' }]
    },
    'inspect_wheel': {
        text: [
            "You look at the caster wheel in your pocket. It's not just broken plastic.",
            "There's a residue inside. Green sludge.",
            "And... is that a leg? An insect leg?",
            "You need a microscope or a really good magnifying glass."
        ],
        effect: (s) => { s.flags.chair_analyzed = true; },
        choices: [{ text: "Put it away", target: 'hub' }]
    },
    'hub': {
        text: ["You are standing in your driveway. The sun is too bright. Where do you go?"],
        choices: [
            { text: "Drive to Mall Construction Site", target: 'mall_site', cost: 60 },
            { text: "Drive to Tecca Factory (Canton)", target: 'tecca_factory', cost: 120 },
            { text: "Go to Electronics Store", target: 'electronics', cost: 45 },
            { text: "Go back inside", target: 'home_inside' }
        ]
    },
    'home_inside': {
        text: ["Back in the safety of the house."],
        choices: [
            { text: "Go to Kitchen", target: 'kitchen' },
            { text: "Check Computer", target: 'computer_home' },
            { text: "Go Outside", target: 'hub' }
        ]
    },
    'computer_home': {
        text: [
            "You log onto your PC. You have 400 unread emails.",
            "One subject line catches your eye: 'TECCA WARRANTY CLAIM #9902'.",
            "It says your claim is denied because the chair was 'misused via excessive force'.",
            "There is a customer service number: 555-0199."
        ],
        choices: [
            { text: "Call 555-0199", target: 'call_tecca', cost: 15 },
            { text: "Search 'Tecca Chair Explosion'", target: 'search_tecca', cost: 30 },
            { text: "Log off", target: 'home_inside' }
        ]
    },
    'call_tecca': {
        text: [
            "Automated Voice: 'Thank you for calling National Business Solutions. For Tecca, press 1.'",
            "You press 1.",
            "'All agents are busy. Your estimated wait time is... 4 hours.'",
            "Music starts playing. It's smooth jazz. It mocks you."
        ],
        choices: [
            { text: "Hang up", target: 'computer_home' },
            { text: "Wait (Costs 2 hours)", target: 'wait_on_hold', cost: 120 } // Trap
        ]
    },
    'wait_on_hold': {
        text: ["You wait. And wait. The sun moves across the room. Eventually, the line clicks.", "'Hello, this is Stacy. We are currently closed.' Click."],
        effect: (s) => { adjustParanoia(10); },
        choices: [{ text: "Scream", target: 'computer_home' }]
    },
    'mall_site': {
        text: [
            "The Canton Marketplace. A tomb of your career.",
            "Your boss, Jeff Levjman, is near the porta-potties. He's wearing a $500 shirt."
        ],
        choices: [
            { text: "Confront Jeff", target: 'confront_jeff', cost: 30 },
            { text: "Dig through the trash", target: 'mall_trash', cost: 30 },
            { text: "Leave", target: 'hub' }
        ]
    },
    'confront_jeff': {
        text: [
            "You walk up to Jeff.",
            "Jeff: 'Ron! You're suspended. You can't be here. Also, can I have my parking pass back?'",
            "He doesn't seem to care about the conspiracy."
        ],
        choices: [
            { text: "Give pass", target: 'give_pass' },
            { text: "Accuse him of sabotage", target: 'accuse_jeff' }
        ]
    },
    'give_pass': {
        text: ["You hand over the pass. He smiles. 'Thanks, buddy. Take some time. Go to a park.'", "He drives off."],
        effect: (s) => { removeItem("Parking Pass"); }, // Assuming he had it
        choices: [{ text: "Return to Hub", target: 'hub' }]
    },
    'accuse_jeff': {
        text: ["Jeff sighs. 'Ron, you're spiraling. It was a chair. Sometimes chairs break. Go home.'", "He walks away."],
        choices: [{ text: "Return to Hub", target: 'hub' }]
    },
    'tecca_factory': {
        text: [
            "The Tecca Chairs factory in Canton. It looks abandoned.",
            "There's a security keypad at the side door.",
            "A sign says: 'DELIVERIES AT REAR'."
        ],
        choices: [
            { text: "Try Front Door", target: 'tecca_front' },
            { text: "Go to Rear", target: 'tecca_rear', cost: 15 },
            { text: "Hack Keypad", target: 'tecca_keypad' }
        ]
    },
    'tecca_front': {
        text: ["Locked. Through the glass, you see rows of chairs wrapped in plastic. They look like cocoons."],
        choices: [{ text: "Back", target: 'tecca_factory' }]
    },
    'tecca_rear': {
        text: [
            "The loading dock. A truck is idling.",
            "The driver is eating a sandwich. Ham.",
            "He drops a slice of ham."
        ],
        choices: [
            { text: "Perform 'The Ham Trick'", target: 'ham_trick', cost: 10, req: { item: 'Ham' } }, // Hidden requirement, player won't have it first run usually
            { text: "Talk to Driver", target: 'talk_driver', cost: 15 },
            { text: "Sneak into Truck", target: 'sneak_truck', cost: 60 }
        ]
    },
    'talk_driver': {
        text: ["Driver: 'You look like the guy who fell. Are you the Chair Man? Haha.'", "He refuses to answer questions."],
        choices: [{ text: "Back", target: 'tecca_factory' }]
    },
    'sneak_truck': {
        text: ["You crawl into the back of the truck. It smells like sawdust and... vinegar?", "The truck starts moving. You are trapped for 3 hours."],
        choices: [{ text: "Wait it out", target: 'truck_ride', cost: 180 }]
    },
    'truck_ride': {
        text: [
            "The truck stops.",
            "You peek out. You are at a Warehouse in the middle of nowhere.",
            "Guards are patrolling. You see boxes marked 'HUNGARY'."
        ],
        effect: (s) => { s.flags.found_warehouse = true; addClue("Warehouse Location Found"); },
        choices: [{ text: "Sneak away and mark GPS", target: 'escape_warehouse' }]
    },
    'escape_warehouse': {
        text: ["You run through the woods for an hour until you find a road. You call an Uber. It costs $80.", "You are back home."],
        choices: [{ text: "Home", target: 'home_inside' }]
    },
    'tecca_keypad': {
        text: ["Enter 4-digit Passcode:"],
        type: 'input',
        solution: '7734', // "hELL" upside down, classic trope
        success: 'tecca_inside',
        fail: 'tecca_fail'
    },
    'tecca_fail': {
        text: ["Access Denied. An alarm chirps. You better leave."],
        choices: [{ text: "Run", target: 'hub' }]
    },
    'tecca_inside': {
        text: [
            "You are inside Tecca.",
            "It's empty. No workers. Just machines building chairs automatically.",
            "You find a manifesto on a desk: 'THE SITUATION'.",
            "It details a plan to sell infested chairs to government buildings to force fumigation contracts.",
            "Wait, who owns the fumigation company? 'BugGone LLC'...",
            "Owned by Alice Quintana."
        ],
        effect: (s) => { addClue("Alice owns BugGone"); addClue("Chairs are bug trojans"); },
        choices: [{ text: "Take Manifesto", target: 'take_manifesto' }]
    },
    'take_manifesto': {
        text: ["You have the proof. You have the manifesto.", "Suddenly, the lights go out.", "A voice over the intercom: 'Mr. Trosper. Please have a seat.'"],
        choices: [{ text: "RUN!", target: 'chase_scene' }]
    },
    'chase_scene': {
        text: ["You sprint through the factory. Chairs slide into your path. Are they moving on their own?", "You burst out the door and dive into your car."],
        choices: [{ text: "Drive Home", target: 'endgame_prep' }]
    },
    'endgame_prep': {
        text: ["You are home. You have the manifesto. You know Alice is behind it.", "You need to expose them."],
        choices: [{ text: "Call the News", target: 'ending_news' }, { text: "Confront Barb", target: 'ending_barb' }]
    },
    'ending_news': {
        text: ["The news anchor laughs at you. 'Sir, this is a handwritten note on a napkin.'", "You look at the manifesto. The ink has disappeared. Disappearing ink.", "THEY THOUGHT OF EVERYTHING.", "BAD ENDING: THE CRAZY MAN."],
        choices: [{ text: "Restart Day 1", target: 'reset' }]
    },
    'ending_barb': {
        text: [
            "You show Barb. She looks at the blank paper.",
            "Barb: 'Ron, I can't do this anymore.'",
            "She leaves.",
            "You sit in your living room.",
            "The doorbell rings.",
            "It's a delivery. A new chair.",
            "From: A Friend.",
            "GAME OVER?"
        ],
        choices: [{ text: "Download Transcript & Restart", target: 'download_end' }]
    },
    'reset': {
        effect: (s) => { location.reload(); },
        text: ["Resetting simulation..."]
    },
    'download_end': {
        effect: (s) => { downloadTranscript(); location.reload(); },
        text: ["Downloading..."]
    }
};

// --- ENGINE FUNCTIONS ---

function log(msg, type = 'normal') {
    const container = document.getElementById('log-container');
    const div = document.createElement('div');
    div.className = `log-entry ${type}`;
    div.innerText = msg;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
}

function updateStats() {
    document.getElementById('day-display').innerText = state.day;
    
    // Format Time
    let h = Math.floor(state.time / 100);
    let m = state.time % 100;
    let timeStr = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
    document.getElementById('time-display').innerText = timeStr;
    
    // Random Dignity
    document.getElementById('dignity-display').innerText = (Math.random() * 15).toFixed(1) + "%";
}

function renderInventory() {
    const invList = document.getElementById('inventory-list');
    invList.innerHTML = '';
    state.inventory.forEach(item => {
        let li = document.createElement('li');
        li.innerText = "- " + item;
        invList.appendChild(li);
    });

    const clueList = document.getElementById('clue-list');
    clueList.innerHTML = '';
    state.clues.forEach(clue => {
        let li = document.createElement('li');
        li.innerText = "? " + clue;
        li.style.color = '#ffff00';
        clueList.appendChild(li);
    });
}

function addItem(item) {
    if(!state.inventory.includes(item)) {
        state.inventory.push(item);
        log(`Added to Pockets: ${item}`, 'system');
        renderInventory();
    }
}

function removeItem(item) {
    state.inventory = state.inventory.filter(i => i !== item);
    renderInventory();
}

function addClue(clue) {
    if(!state.clues.includes(clue)) {
        state.clues.push(clue);
        log(`NEW CONNECTION: ${clue}`, 'system');
        renderInventory();
    }
}

function adjustDignity(amount) {
    // Just flavor
    log(amount > 0 ? "Dignity Restored." : "Dignity Lost.", 'system');
}

function adjustParanoia(amount) {
    log("Paranoia Increasing...", 'horror');
}

function advanceTime(minutes) {
    let oldTime = state.time;
    let h = Math.floor(state.time / 100);
    let m = state.time % 100;

    m += minutes;
    while(m >= 60) {
        m -= 60;
        h += 1;
    }

    state.time = (h * 100) + m;
    
    log(`Time passes... (${minutes} mins)`, 'system');
    
    if(state.time >= state.maxTime) {
        log("It is too late. The day is over.", 'horror');
        state.day++;
        state.time = 900;
        log(`--- DAY ${state.day} START ---`, 'system');
        if(state.day > 5) {
            log("HR HEARING DAY. You have no proof. You are fired.", 'horror');
            setTimeout(() => { location.reload(); }, 3000);
        }
    }
    updateStats();
}

function loadScene(sceneId) {
    const scene = SCENES[sceneId];
    if(!scene) {
        log("Error: Scene missing.", 'horror');
        return;
    }

    // Effect
    if(scene.effect) {
        scene.effect(state);
    }

    // Output Text
    if(scene.text) {
        scene.text.forEach((line, i) => {
            setTimeout(() => {
                log(line, 'dialogue');
            }, i * 600);
        });
    }

    // Wait for text then show choices
    setTimeout(() => {
        renderChoices(scene);
    }, (scene.text ? scene.text.length * 600 : 0) + 200);
}

function renderChoices(scene) {
    const container = document.getElementById('choice-buttons');
    container.innerHTML = '';

    // Handle Input Type Scenes (Keypads)
    if(scene.type === 'input') {
        let input = document.createElement('input');
        input.type = 'text';
        input.style.background = '#000';
        input.style.border = '1px solid #33ff00';
        input.style.color = '#33ff00';
        input.style.padding = '10px';
        input.style.fontFamily = 'monospace';
        
        let btn = document.createElement('button');
        btn.innerText = "SUBMIT";
        btn.onclick = () => {
            if(input.value === scene.solution) {
                loadScene(scene.success);
            } else {
                loadScene(scene.fail);
            }
        };
        container.appendChild(input);
        container.appendChild(btn);
        return;
    }

    // Normal Choices
    if(scene.choices) {
        scene.choices.forEach(choice => {
            let btn = document.createElement('button');
            let costText = choice.cost ? ` [${choice.cost}m]` : '';
            btn.innerText = `> ${choice.text}${costText}`;
            
            // Check reqs
            if(choice.req) {
                if(choice.req.item && !state.inventory.includes(choice.req.item)) {
                    return; // Don't show
                }
            }

            btn.onclick = () => {
                if(choice.cost) advanceTime(choice.cost);
                loadScene(choice.target);
            };
            container.appendChild(btn);
        });
    }
}

function downloadTranscript() {
    let content = "THE CHAIR COMPANY - INVESTIGATION LOG\n\n";
    content += "Status: FAILED\n";
    content += "Clues Found: " + state.clues.join(", ") + "\n";
    content += "\nRon Trosper remains suspended. The Chair Company remains at large.";
    
    const blob = new Blob([content], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'RON_TROSPER_LOG.txt';
    a.click();
}

// --- INIT ---
window.onload = () => {
    log("Initializing Ron Trosper OS v1.0...", 'system');
    setTimeout(() => {
        loadScene('intro');
        updateStats();
        renderInventory();
    }, 1000);
};

</script>

</body></html>
